<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ê³„ì•½ì„œ ë¶„ì„ ì„œë¹„ìŠ¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .risk-high { color: #EF4444; }
        .risk-medium { color: #F59E0B; }
        .risk-low { color: #10B981; }
        .risk-none { color: #6B7280; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">AI ê³„ì•½ì„œ ìë™ ë¶„ì„ ì„œë¹„ìŠ¤</h1>
            <p class="text-gray-600">ê³„ì•½ì„œ ë‚´ìš©ì„ ì•„ë˜ì— ë¶™ì—¬ë„£ê³  'ë¶„ì„ ì‹œì‘' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”. ì ì¬ì ì¸ ìœ„í—˜ ìš”ì†Œë¥¼ ì‹ ì†í•˜ê²Œ ê²€í† í•´ ë“œë¦½ë‹ˆë‹¤.</p>
        </header>

        <main class="bg-white p-6 rounded-xl shadow-md">
            <div>
                <label for="contract-text" class="block text-lg font-semibold mb-2 text-gray-700">ê³„ì•½ì„œ ì›ë¬¸</label>
                <textarea id="contract-text" rows="15" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="ì´ê³³ì— ê³„ì•½ì„œ ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
            </div>
            <div class="text-center mt-6">
                <button id="analyze-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    ë¶„ì„ ì‹œì‘
                </button>
            </div>
        </main>

        <section id="result-section" class="mt-8 bg-white p-6 rounded-xl shadow-md hidden">
            <h2 class="text-2xl font-bold mb-4 border-b pb-2 text-gray-900">ë¶„ì„ ë³´ê³ ì„œ</h2>
            <div id="loader" class="flex justify-center items-center h-40">
                <div class="loader"></div>
            </div>
            <div id="report-content"></div>
        </section>
    </div>

    <script>
        // ì´ ë¶€ë¶„ì€ ì œê³µëœ Python ì½”ë“œë¥¼ JavaScriptë¡œ ë³€í™˜í•œ ê³„ì•½ ë¶„ì„ ì„œë¹„ìŠ¤ì˜ í•µì‹¬ ë¡œì§ì…ë‹ˆë‹¤.
        const DEFAULT_CONFIG = [
            {
                name: "ì¢…ë£Œ",
                keywords: ["terminate", "termination", "cancel", "end"],
                missing_risk: "high",
                summary: "ê³„ì•½ ì¢…ë£Œ ì¡°ê±´ì„ ëª…ì‹œí•©ë‹ˆë‹¤.",
                recommendation: "ì¢…ë£Œ ì¡°ê±´, í†µì§€ ê¸°ê°„ ë° í•´ì§€ í›„ ì˜ë¬´ë¥¼ ëª…í™•íˆ í•˜ì‹­ì‹œì˜¤.",
                warning_keywords: ["without cause", "at any time"],
                positive_keywords: ["for cause", "breach", "insolvency"],
            },
            {
                name: "ê¸°ë°€ìœ ì§€",
                keywords: ["confidentiality", "confidential", "proprietary", "nda"],
                missing_risk: "medium",
                summary: "ê¸°ë°€ ì •ë³´ ë³´í˜¸ ì˜ë¬´ë¥¼ ê·œì •í•©ë‹ˆë‹¤.",
                recommendation: "ê¸°ë°€ ì •ë³´ì˜ ë²”ìœ„, ì˜ˆì™¸ ì‚¬í•­, ë³´í˜¸ ê¸°ê°„ì„ ëª…í™•í•˜ê²Œ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.",
                warning_keywords: ["perpetuity", "forever"],
                positive_keywords: ["return", "destroy", "5 years"],
            },
            {
                name: "ì±…ì„ ì œí•œ",
                keywords: ["limitation of liability", "liable", "indemnify"],
                missing_risk: "low",
                summary: "ì†í•´ë°°ìƒ ì±…ì„ì„ ì œí•œí•˜ëŠ” ì¡°í•­ì…ë‹ˆë‹¤.",
                recommendation: "ì±…ì„ ì œí•œì˜ ìƒí•œì„ ì´ í•©ë¦¬ì ì¸ì§€, ê³ ì˜ ë˜ëŠ” ì¤‘ê³¼ì‹¤ì´ ì œì™¸ë˜ëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤.",
                warning_keywords: ["indirect", "consequential", "special", "punitive", "lost profits"],
                positive_keywords: ["direct damages", "gross negligence", "willful misconduct"],
            },
            {
                name: "ì§€ì  ì¬ì‚°ê¶Œ",
                keywords: ["intellectual property", "ip", "ownership", "license"],
                missing_risk: "high",
                summary: "ê²°ê³¼ë¬¼ì— ëŒ€í•œ ì§€ì  ì¬ì‚°ê¶Œì˜ ì†Œìœ  ë° ì‚¬ìš© ê¶Œí•œì„ ì •ì˜í•©ë‹ˆë‹¤.",
                recommendation: "ê¸°ì¡´ IPì™€ ì‹ ê·œ ê°œë°œ IPì˜ ì†Œìœ ê¶Œì„ ëª…í™•íˆ í•˜ê³ , ë¼ì´ì„ ìŠ¤ ë²”ìœ„ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ í•´ì•¼ í•©ë‹ˆë‹¤.",
                warning_keywords: ["assigns all right", "transfer all ownership"],
                positive_keywords: ["retains ownership", "non-exclusive license"],
            },
            {
                name: "ì¤€ê±°ë²• ë° ì¬íŒ ê´€í• ",
                keywords: ["governing law", "jurisdiction", "venue"],
                missing_risk: "medium",
                summary: "ë²•ì  ë¶„ìŸ ë°œìƒ ì‹œ ì ìš©ë  ë²•ë¥ ê³¼ ì¬íŒì„ ì§„í–‰í•  ë²•ì›ì„ ì§€ì •í•©ë‹ˆë‹¤.",
                recommendation: "ìì‹ ì—ê²Œ ìœ ë¦¬í•œ ë²•ë¥ ê³¼ ì¬íŒ ê´€í• ì¸ì§€ í™•ì¸í•˜ê³ , ë¶ˆë¦¬í•  ê²½ìš° ìˆ˜ì •ì„ ìš”ì²­í•˜ì‹­ì‹œì˜¤.",
                warning_keywords: [],
                positive_keywords: [],
            }
        ];

        class ContractReviewService {
            constructor(config = DEFAULT_CONFIG) {
                this.config = config;
            }

            review(text) {
                const normalizedText = this._normaliseText(text);
                const sentences = this._splitSentences(normalizedText);
                const results = this.config.map(clauseConfig => this._evaluateClause(clauseConfig, sentences));
                return results;
            }

            generate_report(review) {
                let lines = ["<h2>ì¢…í•© ìœ„í—˜ë„ í‰ê°€</h2>"];
                const riskCounts = { high: 0, medium: 0, low: 0 };
                review.forEach(r => {
                    if (r.present && r.risk_level !== 'none') {
                       if (riskCounts[r.risk_level] !== undefined) riskCounts[r.risk_level]++;
                    } else if (!r.present) {
                       if (riskCounts[r.missing_risk] !== undefined) riskCounts[r.missing_risk]++;
                    }
                });
                
                let overallRisk = "low";
                if (riskCounts.high > 0) overallRisk = "high";
                else if (riskCounts.medium > 0) overallRisk = "medium";

                lines.push(`<p class="mb-6">ì´ ê³„ì•½ì˜ ì „ë°˜ì ì¸ ìœ„í—˜ë„ëŠ” <strong class="risk-${overallRisk} uppercase font-bold">${overallRisk}</strong> ìˆ˜ì¤€ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤. ì•„ë˜ ì„¸ë¶€ ë¶„ì„ì„ í™•ì¸í•˜ì„¸ìš”.</p>`);
                lines.push("<h2>ì£¼ìš” ì¡°í•­ ë¶„ì„ ê²°ê³¼</h2>");
                
                const clauses = review.map(r => {
                    const riskLevel = r.present ? r.risk_level : r.missing_risk;
                    const riskClass = `risk-${riskLevel}`;
                    let clauseHtml = `<div class="mb-6 p-4 border rounded-lg ${riskLevel === 'high' ? 'border-red-200 bg-red-50' : riskLevel === 'medium' ? 'border-amber-200 bg-amber-50' : 'border-gray-200 bg-gray-50'}">`;
                    clauseHtml += `<h3 class="text-xl font-semibold">${r.name} <span class="text-sm font-bold uppercase ${riskClass}">(${riskLevel})</span></h3>`;

                    if (r.present) {
                        clauseHtml += `<p class="text-sm text-gray-600 mt-1">ê´€ë ¨ ë¬¸ì¥ì´ ${r.matched_sentences.length}ê°œ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>`;
                    } else {
                        clauseHtml += `<p class="text-sm text-gray-600 mt-1">ê´€ë ¨ ì¡°í•­ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>`;
                    }

                    if (r.issues && r.issues.length > 0) {
                        clauseHtml += '<div class="mt-3"><strong class="text-gray-700">âš ï¸ ì ì¬ì  ë¬¸ì œ:</strong><ul class="list-disc list-inside text-gray-600 text-sm mt-1">';
                        r.issues.forEach(issue => clauseHtml += `<li>${issue}</li>`);
                        clauseHtml += '</ul></div>';
                    }

                    if (r.notes && r.notes.length > 0) {
                        clauseHtml += '<div class="mt-3"><strong class="text-gray-700">ê¸ì •ì  ìš”ì†Œ:</strong><ul class="list-disc list-inside text-gray-600 text-sm mt-1">';
                        r.notes.forEach(note => clauseHtml += `<li>${note}</li>`);
                        clauseHtml += '</ul></div>';
                    }

                    const recommendation = this.config.find(c => c.name === r.name).recommendation;
                    if (recommendation) {
                        clauseHtml += `<div class="mt-3"><strong class="text-gray-700">ğŸ’¡ ê¶Œì¥ ì¡°ì¹˜:</strong><p class="text-gray-600 text-sm">${recommendation}</p></div>`;
                    }
                    
                    clauseHtml += '</div>';
                    return clauseHtml;
                });
                
                lines.push(...clauses);
                return lines.join('');
            }

            _normaliseText(text) {
                return text.trim().toLowerCase().replace(/\s+/g, ' ');
            }

            _splitSentences(text) {
                // ë¬¸ì¥ ë¶„ë¦¬ ì •ê·œì‹: ë§ˆì¹¨í‘œ, ë¬¼ìŒí‘œ, ëŠë‚Œí‘œ ë’¤ì— ê³µë°±ì´ ì˜¤ëŠ” ê²½ìš°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
                return text.split(/(?<=[.!?])\s+/).filter(sentence => sentence.trim());
            }
            
            _buildKeywordPattern(keyword) {
                // í‚¤ì›Œë“œê°€ ë‹¨ì–´ ë‹¨ìœ„ë¡œ ì¼ì¹˜í•˜ë„ë¡ ì •ê·œì‹ íŒ¨í„´ì„ ìƒì„±í•©ë‹ˆë‹¤. (ì˜ˆ: 'term'ì´ 'determine'ì— í¬í•¨ë˜ì§€ ì•Šë„ë¡)
                keyword = keyword.trim().toLowerCase();
                if (!keyword) return new RegExp('^$');

                // ê³µë°±ì„ í¬í•¨í•˜ëŠ” êµ¬ë¬¸ ì²˜ë¦¬
                if (/\s/.test(keyword)) {
                    const parts = keyword.split(/\s+/).filter(part => part).map(part => this._escapeRegExp(part));
                    return new RegExp(`\\b${parts.join('\\s+')}\\b`, 'i');
                } 
                // ë‹¨ì¼ ë‹¨ì–´ ì²˜ë¦¬
                else if (/\w/.test(keyword)) {
                    return new RegExp(`\\b${this._escapeRegExp(keyword)}\\b`, 'i');
                } 
                // ê¸°íƒ€ íŠ¹ìˆ˜ë¬¸ì ë“± ì²˜ë¦¬
                else {
                    return new RegExp(this._escapeRegExp(keyword), 'i');
                }
            }

            _escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            _evaluateClause(config, sentences) {
                const keywordPatterns = config.keywords.map(kw => this._buildKeywordPattern(kw));
                const matched = sentences.filter(sentence => keywordPatterns.some(pattern => pattern.test(sentence)));

                const issues = [];
                const notes = [];
                let risk = matched.length > 0 ? "low" : config.missing_risk;

                if (matched.length > 0) {
                    const { warnings, positives } = this._evaluateWarnings(config, matched);
                    issues.push(...warnings);
                    notes.push(...positives);

                    if (warnings.length > 0 && risk !== "high") {
                        risk = "medium";
                    }
                    if (warnings.some(w => w.includes('ì‹¬ê°'))) { // ì˜ˆì‹œ: íŠ¹ì • í‚¤ì›Œë“œê°€ í¬í•¨ë˜ë©´ ìœ„í—˜ë„ ìƒí–¥
                        risk = "high";
                    }
                }

                if (matched.length === 0) {
                    issues.push(`${config.name} ì¡°í•­ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
                }

                return {
                    name: config.name,
                    present: matched.length > 0,
                    risk_level: risk,
                    matched_sentences: matched,
                    issues: issues,
                    notes: notes,
                };
            }
            
            _evaluateWarnings(config, sentences) {
                const warnings = [];
                const positives = [];
                
                const warningPatterns = config.warning_keywords.map(kw => this._buildKeywordPattern(kw));
                const positivePatterns = config.positive_keywords.map(kw => this._buildKeywordPattern(kw));

                sentences.forEach(sentence => {
                    warningPatterns.forEach((pattern, i) => {
                        if (pattern.test(sentence)) {
                            warnings.push(`'${config.warning_keywords[i]}' í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆì–´ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);
                        }
                    });
                    positivePatterns.forEach((pattern, i) => {
                        if (pattern.test(sentence)) {
                            positives.push(`'${config.positive_keywords[i]}' ì™€ ê°™ì€ ê¸ì •ì  í‘œí˜„ì´ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        }
                    });
                });
                return { warnings: [...new Set(warnings)], positives: [...new Set(positives)] };
            }
        }

        // DOM ìš”ì†Œ ì—°ê²° ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        const analyzeBtn = document.getElementById('analyze-btn');
        const contractText = document.getElementById('contract-text');
        const resultSection = document.getElementById('result-section');
        const reportContent = document.getElementById('report-content');
        const loader = document.getElementById('loader');
        
        analyzeBtn.addEventListener('click', () => {
            const text = contractText.value;
            if (!text.trim()) {
                alert('ê³„ì•½ì„œ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            resultSection.classList.remove('hidden');
            reportContent.classList.add('hidden');
            loader.style.display = 'flex';

            // ì‹¤ì œ ë°±ì—”ë“œ í˜¸ì¶œì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê¸° ìœ„í•´ ì•½ê°„ì˜ ì§€ì—° ì‹œê°„ì„ ì¤ë‹ˆë‹¤.
            setTimeout(() => {
                const service = new ContractReviewService();
                const reviewResult = service.review(text);
                const reportHtml = service.generate_report(reviewResult);

                reportContent.innerHTML = reportHtml;
                loader.style.display = 'none';
                reportContent.classList.remove('hidden');
            }, 1000);
        });

    </script>
</body>
</html>
